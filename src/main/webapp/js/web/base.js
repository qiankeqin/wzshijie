/*! www.xiaomi.com - v1.1.1 - 2015 */if("undefined"==typeof XIAOMI||!XIAOMI)var XIAOMI={};XIAOMI.namespace=function(){var i,j,d,a=arguments,o=null;for(i=0;i<a.length;i+=1)for(d=(""+a[i]).split("."),o=XIAOMI,j="XIAOMI"==d[0]?1:0;j<d.length;j+=1)o[d[j]]=o[d[j]]||{},o=o[d[j]];return o},XIAOMI.lang=XIAOMI.lang||{},function(){var L=XIAOMI.lang,OP=Object.prototype,ARRAY_TOSTRING="[object Array]",FUNCTION_TOSTRING="[object Function]",OBJECT_TOSTRING="[object Object]",NOTHING=[],HTML_CHARS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},ADD=["toString","valueOf"],OB={isArray:function(o){return OP.toString.apply(o)===ARRAY_TOSTRING},isBoolean:function(o){return"boolean"==typeof o},isFunction:function(o){return"function"==typeof o||OP.toString.apply(o)===FUNCTION_TOSTRING},isNull:function(o){return null===o},isNumber:function(o){return"number"==typeof o&&isFinite(o)},isObject:function(o){return o&&("object"==typeof o||L.isFunction(o))||!1},isString:function(o){return"string"==typeof o},isUndefined:function(o){return"undefined"==typeof o},_IEEnumFix:-[1]?function(){}:function(r,s){var i,fname,f;for(i=0;i<ADD.length;i+=1)fname=ADD[i],f=s[fname],L.isFunction(f)&&f!=OP[fname]&&(r[fname]=f)},escapeHTML:function(html){return html.replace(/[&<>"'\/`]/g,function(match){return HTML_CHARS[match]})},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},extend:function(subc,superc,overrides){if(!superc||!subc)throw new Error("extend failed, please check that all dependencies are included.");var i,F=function(){};if(F.prototype=superc.prototype,subc.prototype=new F,subc.prototype.constructor=subc,subc.superclass=superc.prototype,superc.prototype.constructor==OP.constructor&&(superc.prototype.constructor=superc),overrides){for(i in overrides)L.hasOwnProperty(overrides,i)&&(subc.prototype[i]=overrides[i]);L._IEEnumFix(subc.prototype,overrides)}},augmentObject:function(r,s){if(!s||!r)throw new Error("Absorb failed, verify dependencies.");var i,p,a=arguments,overrideList=a[2];if(overrideList&&overrideList!==!0)for(i=2;i<a.length;i+=1)r[a[i]]=s[a[i]];else{for(p in s)!overrideList&&p in r||(r[p]=s[p]);L._IEEnumFix(r,s)}return r},augmentProto:function(r,s){if(!s||!r)throw new Error("Augment failed, verify dependencies.");var i,a=[r.prototype,s.prototype];for(i=2;i<arguments.length;i+=1)a.push(arguments[i]);return L.augmentObject.apply(this,a),r},dump:function(o,d){var i,len,s=[],OBJ="{...}",FUN="f(){...}",COMMA=", ",ARROW=" => ";if(!L.isObject(o))return o+"";if(o instanceof Date||"nodeType"in o&&"tagName"in o)return o;if(L.isFunction(o))return FUN;if(d=L.isNumber(d)?d:3,L.isArray(o)){for(s.push("["),i=0,len=o.length;len>i;i+=1)s.push(L.isObject(o[i])?d>0?L.dump(o[i],d-1):OBJ:o[i]),s.push(COMMA);s.length>1&&s.pop(),s.push("]")}else{s.push("{");for(i in o)L.hasOwnProperty(o,i)&&(s.push(i+ARROW),s.push(L.isObject(o[i])?d>0?L.dump(o[i],d-1):OBJ:o[i]),s.push(COMMA));s.length>1&&s.pop(),s.push("}")}return s.join("")},substitute:function(s,o,f,recurse){for(var i,j,k,key,v,meta,token,dump,objstr,saved=[],lidx=s.length,DUMP="dump",SPACE=" ",LBRACE="{",RBRACE="}";(i=s.lastIndexOf(LBRACE,lidx),!(0>i))&&(j=s.indexOf(RBRACE,i),!(i+1>j));)token=s.substring(i+1,j),key=token,meta=null,k=key.indexOf(SPACE),k>-1&&(meta=key.substring(k+1),key=key.substring(0,k)),v=o[key],f&&(v=f(key,v,meta)),L.isObject(v)?L.isArray(v)?v=L.dump(v,parseInt(meta,10)):(meta=meta||"",dump=meta.indexOf(DUMP),dump>-1&&(meta=meta.substring(4)),objstr=v.toString(),v=objstr===OBJECT_TOSTRING||dump>-1?L.dump(v,parseInt(meta,10)):objstr):L.isString(v)||L.isNumber(v)||(v="~-"+saved.length+"-~",saved[saved.length]=token),s=s.substring(0,i)+v+s.substring(j+1),recurse===!1&&(lidx=i-1);for(i=saved.length-1;i>=0;i-=1)s=s.replace(new RegExp("~-"+i+"-~"),"{"+saved[i]+"}","g");return s},trim:function(s){try{return s.replace(/^\s+|\s+$/g,"")}catch(e){return s}},merge:function(){var i,o={},a=arguments,l=a.length;for(i=0;l>i;i+=1)L.augmentObject(o,a[i],!0);return o},later:function(when,o,fn,data,periodic){when=when||0,o=o||{};var f,r,m=fn,d=data;if(L.isString(fn)&&(m=o[fn]),!m)throw new TypeError("method undefined");return L.isUndefined(data)||L.isArray(d)||(d=[data]),f=function(){m.apply(o,d||NOTHING)},r=periodic?setInterval(f,when):setTimeout(f,when),{interval:periodic,cancel:function(){this.interval?clearInterval(r):clearTimeout(r)}}},isValue:function(o){return L.isObject(o)||L.isString(o)||L.isNumber(o)||L.isBoolean(o)}};L.hasOwnProperty=OP.hasOwnProperty?function(o,prop){return o&&o.hasOwnProperty&&o.hasOwnProperty(prop)}:function(o,prop){return!L.isUndefined(o[prop])&&o.constructor.prototype[prop]!==o[prop]},OB.augmentObject(L,OB,!0),L.augment=L.augmentProto,XIAOMI.augment=L.augmentProto,XIAOMI.extend=L.extend}();;(function(){function parse(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){16>ii&&(buf[i+ii++]=_hexToByte[oct])});16>ii;)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=null!=options.clockseq?options.clockseq:_clockseq,msecs=null!=options.msecs?options.msecs:(new Date).getTime(),nsecs=null!=options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(0>dt&&null==options.clockseq&&(clockseq=clockseq+1&16383),(0>dt||msecs>_lastMSecs)&&null==options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;6>n;n++)b[i+n]=node[n];return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new BufferClass(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||_rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;16>ii;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var _rng,_global=this;if("function"==typeof require)try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var r,i=0;16>i;i++)0===(3&i)&&(r=4294967296*Math.random()),_rnds[i]=r>>>((3&i)<<3)&255;return _rnds}}for(var BufferClass="function"==typeof Buffer?Buffer:Array,_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;if(uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,uuid.BufferClass=BufferClass,_global.define&&define.amd)define(function(){return uuid});else if("undefined"!=typeof module&&module.exports)module.exports=uuid;else{var _previousRoot=_global.uuid;uuid.noConflict=function(){return _global.uuid=_previousRoot,uuid},_global.uuid=uuid}}).call(this);;XIAOMI.namespace("app.analytics"),XIAOMI.app.analytics=function(element,options){this.options={page:"首页",position:["A1"],url:!0,JQelement:!1,isStat:!1,onlyStat:!1,pidPosition:["头部区域"],statSign:"stat"};for(var p in options)this.options[p]=options[p];for(var _this=this,isURL=_this.options.url?!0:!1,trimAll=function(s){try{return s.replace(/\s/g,"")}catch(e){return s}},bindFunction=function(links){$.each(links,function(k,v){var paramString=isURL?$(v).attr("href"):XIAOMI.lang.trim($(v).find("img").attr("alt")||$(v).text()),paramIndex=k,parmas_1=_this.options.page,parmas_2=parmas_1+"_"+_this.options.position[i]+"_"+paramIndex,parmas_3=parmas_2+"_"+paramString,parmas="'PC','"+parmas_3+"'",aidString=$(v).find("img").attr("alt")||$(v).text()||$(v).find("img").attr("title"),pidParmas=_this.options.statSign+"_"+_this.options.pidPosition[i]+"_"+paramIndex;aidString=trimAll(aidString),_this.options.onlyStat?$(v).attr({"data-stat-pid":pidParmas,"data-stat-aid":aidString}):_this.options.isStat?$(v).attr({"data-stat-pid":pidParmas,"data-stat-aid":aidString,onclick:"_hmt.push(['_trackEvent',"+parmas+"]);"}):$(v).attr("onclick","_hmt.push(['_trackEvent',"+parmas+"]);")})},i=0;i<element.length;i++){var links=_this.options.JQelement?element[i]:$(element[i]).find("a");bindFunction(links)}},XIAOMI.namespace("app.updateMiniCart, app.addShopCart, app.addShopCartEvent"),XIAOMI.app.updateMiniCart=function(){var num=XIAOMI.app.cookie("xm_user_www_num");return num&&parseFloat(num)>0?($(".J_cartNum").html("("+num+")").show(),num):($(".J_cartNum").html("").hide(),0)},XIAOMI.app.addShopCart=function(gid,callback,obj){if(gid&&"function"==typeof callback){var ajaxUrl=XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/add/"+gid;$.ajax({url:ajaxUrl,dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){var endCallback=function(){callback(data,obj),XIAOMI.app.updateMiniCart()};1===data.needSec?XIAOMI.app.killRobot.init(gid,endCallback):endCallback()}})}},XIAOMI.app.addShopCartEvent=function(options){var op={obj:".xmAddShopCart",before:null,callback:null,overCallback:null};$.extend(op,options||{}),$(document).on("click",op.obj,function(event){var gid=$(this).attr("data-gid"),isDisabled=$(this).attr("data-disabled")||"false",isPackage=$(this).attr("data-package")||"false";if("false"===isDisabled){if($(this).attr("data-disabled","true"),"function"==typeof op.before&&op.before(),!gid||"true"===isPackage||"function"!=typeof op.callback)return!0;var dmSkuArr=XIAOMI.GLOBAL_CONFIG.damiaoGoodsId?XIAOMI.GLOBAL_CONFIG.damiaoGoodsId:!1,isToDm=!1;if(dmSkuArr!==!1&&"object"==typeof dmSkuArr&&(isToDm=$.inArray(gid,dmSkuArr)>=0?!0:!1),isToDm===!0){var dmLogin=new XIAOMI.app.miniLogin;XIAOMI.app.cookie("userId")&&XIAOMI.app.cookie("xm_order_btauth")?XIAOMI.app.dmFun.init({sku:gid,callback:op.callback,obj:$(this),overCallback:op.overCallback}):XIAOMI.app.cookie("userId")?(dmLogin._proxyiframe(),XIAOMI.app.dmFun.init({sku:gid,callback:op.callback,obj:$(this),overCallback:op.overCallback})):window.location.href=XIAOMI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href}else XIAOMI.app.addShopCart(gid,op.callback,$(this))}return!1})},function(){document.write=document.writeln=function(){};for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}(),XIAOMI.namespace("app.cookie"),XIAOMI.app.cookie=function(key,value,options){if(arguments.length>1&&"[object Object]"!==String(value)){if(options=jQuery.extend({},options),(null===value||void 0===value)&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return value=String(value),document.cookie=[encodeURIComponent(key),"=",options.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}options=value||{};var result,decode=options.raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null},XIAOMI.namespace("app.dmFun"),XIAOMI.app.dmFun={init:function(options){var _this=this;_this.config={sku:null,callback:null,obj:null,overCallback:null,sourceVal:"bigtap"},_this.inTheQueue=!1,$.extend(_this.config,options),_this.startQueue(),_this.getDmSys(),$("#xmDmReload").off().on("click",function(){_this.config.obj.trigger("click")})},getDmSys:function(){var _this=this,cbName="cn"+_this.config.sku,hdget=XIAOMI.GLOBAL_CONFIG.damiaoSite+"hdget/cn?source="+_this.config.sourceVal+"&product="+_this.config.sku+"&addcart=1&m=1&_="+(new Date).getTime();$.ajax({type:"GET",url:hdget,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:cbName,timeout:3e4,error:function(){return _this.inTheQueue?(_this.stopQueue(),void $("#xmDmError").modal({show:!0,backdrop:"static"})):!1},success:function(data){var jsonStr=data.status,token=jsonStr[_this.config.sku].hdurl,isOver=jsonStr[_this.config.sku].hdstart===!1&&jsonStr[_this.config.sku].hdstop===!0?!0:!1,speed=data.d22a51?1e3*data.d22a51:5e3;return _this.inTheQueue?(data.login===!1&&(location.href=XIAOMI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href),isOver===!0?(_this.stopQueue(),"function"==typeof _this.config.overCallback?_this.config.overCallback(_this.config.obj):alert("抱歉，商品已售罄！"),!1):(_this.getDmTimer&&clearTimeout(_this.getDmTimer),void(token?_this.getShopCart(token):(_this.inTheQueue||_this.startQueue(),_this.getDmTimer=setTimeout(function(){_this.getDmSys()},speed))))):!1}})},getShopCart:function(token){if(!token)return!1;var _this=this,addCart=XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/add/"+this.config.sku+"?source="+_this.config.sourceVal+"&token="+token;$.ajax({type:"GET",url:addCart,dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){_this.stopQueue(),"function"==typeof _this.config.callback&&_this.config.callback(data,_this.config.obj),XIAOMI.app.updateMiniCart()}})},startQueue:function(){var _this=this;$("#xmDmError").modal("hide"),$("#xmDmQueue").modal({show:!0,backdrop:"static"}),_this.queueAnimate(),_this.inTheQueue=!0,$("#xmDmQueue").on("hidden.bs.modal",function(e){_this.stopQueue(),_this.config.obj.attr("data-disabled","false")})},stopQueue:function(){$("#xmDmQueue").modal("hide"),this.inTheQueue=!1,this.getDmTimer&&clearTimeout(this.getDmTimer),window.queueAnimateTimer&&clearInterval(queueAnimateTimer)},queueAnimate:function(){var flag=0,speed=200,loop=function(){flag-=90,-900>=flag&&(flag=0),$("#mituWalking").css({"background-position":flag+"px 0"})};window.queueAnimateTimer=setInterval(loop,speed)}},XIAOMI.namespace("app.footer"),XIAOMI.app.footer={init:function(){var _this=this;_this.retinizer(),_this.modalCommonTrack(),_this.siteList(),XIAOMI.app.analytics([".site-topbar",".open-buy-info",".site-logo",".cart-section",".footer-links",".footer-info",".footer-service",".hot-words",".J_menuNavMain"],{position:["A","顶部链接","logo","A","about","footer","service","hotwords","A"],url:!1,isStat:!0,pidPosition:["头部顶部站点导航","头部开放购买","头部LOGO","头部购物车","尾部帮助中心","尾部版权","尾部服务","头部搜索热词","头部导航菜单"]}),$(".J_item-detail-more").parent().addClass("children-list-more"),$(".J_item-detail-four").parent().addClass("children-list-four")},retinizer:function(){var img=new Image;if("srcset"in img)return!1;if("undefined"==typeof window.devicePixelRatio||window.devicePixelRatio<=1.5)return!1;var $img=$("img");$img.each(function(){var srcset=$(this).attr("srcset");srcset&&srcset.split(" 2x")[0]&&$(this).attr("src",srcset.split(" 2x")[0])})},siteList:function(){$(".J_globalList").on({mouseenter:function(){$(this).find(".global-site-list").show()},mouseleave:function(){$(this).find(".global-site-list").hide()}})},modalRender:function(obj){obj.css({width:obj.attr("data-width"),height:obj.attr("data-height")}).modal({backdrop:!0,keyboard:!0,show:!0})},modalCommonTrack:function(){var _this=this,$modalWeixin=$("#J_modalWeixin"),$modalGlobalSites=$("#J_modal-globalSites");$(".J_modalWeixin").on("click",function(){_this.modalRender($modalWeixin)}),$(".J-modal-globalSites").on("click",function(){_this.modalRender($modalGlobalSites)})},serviceTime2015:function(){var now=(new Date).getTime()/1e3,startTime=new Date("2015/2/15 00:00:00").getTime()/1e3,endTime=new Date("2015/2/25 00:00:00").getTime()/1e3;now>=startTime&&($(".J_ServiceTime2015").show(),$(".J_ServiceTimeOld").hide()),now>=endTime&&($(".J_ServiceTime2015").hide(),$(".J_ServiceTimeOld").show())}},XIAOMI.namespace("app.getRegions"),XIAOMI.app.getRegions={getUrl:"/region/index",getData:function(parent,target,sId){var _this=this;$.ajax({type:"GET",url:_this.getUrl,data:"parent="+parent,dataType:"json",success:function(data){data&&_this.formatData(data,target,sId)}})},formatData:function(jsonData,target,sId){for(var dataArray=jsonData.regions,lens=dataArray.length,obj=$("#"+target),options="<option value='0'>"+obj.children("option").eq(0).html()+"</option>",i=0;lens>i;i+=1){var isSelected=dataArray[i].region_id===sId?"selected":"";options+="<option zipcode='"+dataArray[i].zipcode+"' value='"+dataArray[i].region_id+"'"+isSelected+">"+dataArray[i].region_name+"</option>"}$("#"+target).html(options).attr("disabled",!1)}},XIAOMI.namespace("app.History"),XIAOMI.app.History=function(obj){var historyVal=XIAOMI.app.cookie("XM_scan_history"),itemArray=null,goodsUrl=null;if(!historyVal)return!1;historyVal=historyVal.split("#m#");for(var lens=historyVal.length-1,objArr=[],i=0;lens>i;i++){itemArray=historyVal[i].split(","),goodsUrl=XIAOMI.GLOBAL_CONFIG.itemSite+"/"+itemArray[3]+".html";var pro={};pro.imgUrl=itemArray[0],pro.goodsUrl=goodsUrl,pro.name=itemArray[1],pro.price=itemArray[2],pro.starClass=itemArray[4],pro.gid=itemArray[3],objArr.push(pro)}return objArr},$(function(){var Util={base64:function(){function encode64(input){input=escape(input);var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output}function decode64(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0,base64test=/[^A-Za-z0-9\+\/\=]/g;base64test.exec(input)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=keyStr.indexOf(input.charAt(i++)),enc2=keyStr.indexOf(input.charAt(i++)),enc3=keyStr.indexOf(input.charAt(i++)),enc4=keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!==enc3&&(output+=String.fromCharCode(chr2)),64!==enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return unescape(output)}var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",returnObj={};return returnObj.encode=encode64,returnObj.decode=decode64,returnObj},jsonp:function(url,callback,errorCallback){$.ajax({url:url,dataType:"jsonp",jsonp:"jsonpcallback",success:callback,error:errorCallback,timeout:5e3})},judgeIe:function(version_num){var browser=navigator.appName,b_version=navigator.appVersion,version=b_version.split(";");if(version[1]){var trim_Version=version[1].replace(/[ ]/g,"");return"Microsoft Internet Explorer"==browser&&trim_Version=="MSIE"+version_num+".0"?!0:!1}return!1},getPrimeNumber:function(max){for(var primeNumber=[],isPrimeNumber=!0,i=2;max>=i;i++){isPrimeNumber=!0;for(var j=2;i>j;j++)i%j===0&&(isPrimeNumber=!1);isPrimeNumber&&primeNumber.push(i)}return primeNumber},powMod:function(a,b,p){for(var ans=1,tmp=a;0!==b;)1&b&&(ans=ans*tmp%p),tmp=tmp*tmp%p,b>>=1;return ans},loadjsSync:function(url,callback,_t){var f,queue,script;__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},f=arguments.callee,__indexOf.call(f,"queue")>=0||(f.queue={}),queue=f.queue,__indexOf.call(queue,url)>=0&&callback&&(queue[url]?queue[url].push(callback):callback(_t)),callback?queue[url]=[callback]:queue[url]=[],script=document.createElement("script"),script.type="text/javascript",script.onload=script.onreadystatechange=function(){if(!script.readyState||"loaded"===script.readyState||"complete"===script.readyState){for(script.onreadystatechange=script.onload=null;queue[url].length;)queue[url].shift()(_t);return queue[url]=null,queue}},script.src=url,document.getElementsByTagName("head")[0].appendChild(script)}},MainProces={config:function(){var _t=this;_t.isNeedKillRobot=!1,_t.targetDom=[],_t.mouseInitPos={},_t.lastTime=0,_t.currentTime=0,_t.maxNoTouchTime=5e3,_t.isRobot=!1,_t.keyNum={},_t.goodsId=0,_t.hovercallback=null,_t.curObj=null},init:function(gid,callback){var _t=this;_t.config(),callback&&(_t.endCallback=callback),_t.goodsId=gid;var initCallback=function(){_t.getTokenUrl=XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/secToken.php",_t.addCartUrl=XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/secAdd.php",_t.createKey(),_t.getAjaxToken($.proxy(_t.addShopCart,_t))};XIAOMI.GLOBAL_CONFIG.wwwSite&&Util.loadjsSync(XIAOMI.GLOBAL_CONFIG.wwwSite+"/js/libs/crypro.js",initCallback)},initPage:function(){var _t=this,targetDom=_t.targetDom;$("body").find("a").each(function(){var goodsId=$(this).attr("data-kr-id");if(goodsId&&XIAOMI&&XIAOMI.GLOBAL_CONFIG&&XIAOMI.GLOBAL_CONFIG.damiaoGoodsId){var damiaoFlag=$.inArray(goodsId,XIAOMI.GLOBAL_CONFIG.damiaoGoodsId);if(-1===damiaoFlag){var exitFlag=$.inArray(goodsId,XIAOMI.GLOBAL_CONFIG.encryptGoodsId);exitFlag>-1&&targetDom.push($(this))}}}),targetDom.length>0&&(_t.isNeedKillRobot=!0)},drawCircleOverBtn:function(){for(var _t=this,_targetDom=_t.targetDom,i=($(window).width(),$(window).height(),0);i<_targetDom.length;i++){var _this=_targetDom[i],_x=_this.offset().left,_y=_this.offset().top,_width=_this.outerWidth(),_height=_this.outerHeight(),_zindexThis=(Math.sqrt(_width/2*_width/2+_height/2*_height/2),_this.css("z-index")),hoverZindex=10;"auto"!==_zindexThis?hoverZindex=_zindexThis+10:_this.css("z-index",5);var kr=_this.attr("data-kr-id"),backmethod=_this.attr("data-kr-callback");if(Util.judgeIe("6")||Util.judgeIe("7")||Util.judgeIe("8")||Util.judgeIe("9")||Util.judgeIe("10")){var span_com='<div class="J_hoverSpan" data-kr-id="'+kr+'" data-kr-callback="'+backmethod+'" id="J_hoverDom'+i+'" style="cursor:pointer;position:absolute;width:'+_width+"px;height:"+_height+"px;left: 0px;top: 0px;z-index: "+hoverZindex+';"  >'+_this.html()+"</div>";_this.after(span_com),$("#J_hoverDom"+i).css("color",_this.css("color")),$("#J_hoverDom"+i).css("font-size",_this.css("font-size")),$("#J_hoverDom"+i).css("line-height",_this.css("line-height")),$("#J_hoverDom"+i).css("background-color",_this.css("background-color")),$("#J_hoverDom"+i).css("text-align",_this.css("text-align"))}else{var span_com='<div class="J_hoverSpan" data-kr-id="'+kr+'" data-kr-callback="'+backmethod+'" id="J_hoverDom'+i+'" style="cursor:pointer;position:absolute;width:'+_width+"px;height:"+_height+"px;left: 0px;top: 0px;z-index: "+hoverZindex+';"  ></div>';_this.after(span_com)}var parPos=_this.parent()[0].style.position;parPos||(_this.parent()[0].style.position="relative");var _px=_this.parent().offset().left,_py=_this.parent().offset().top,_xx=_x-_px,_yy=_y-_py;$("#J_hoverDom"+i).css("left",_xx).css("top",_yy)}},getMouseInit:function(){var index=0,_t=this;$("body").mousemove(function(e){var _x=e.pageX,_y=e.pageY;index++,1===index&&(_t.mouseInitPos.x=_x,_t.mouseInitPos.y=_y)})},getNextTouchTime:function(){var _t=this;if(_t.lastTime>0){var randomTime=parseInt(Math.random()*_t.maxNoTouchTime),nextTouchTime=_t.lastTime+randomTime;return nextTouchTime}return 0},mouseDownCart:function(){var _t=this;$(".J_hoverSpan").each(function(){$(this).click(function(){_t.goodsId=$(this).attr("data-kr-id"),_t.hovercallback=$(this).attr("data-kr-callback"),_t.curObj=$(this).prev("a");var _x=$(this).offset().left,_y=$(this).offset().top,_wid=$(this).width(),_hei=$(this).height(),_maxX=_x+_wid,_maxY=_y+_hei,clickFlag=$(this).attr("click-flag");_t.currentTime=(new Date).getTime();if(_t.mouseInitPos.x||($(this).attr("click-flag",!0),_t.isRobot=!0),!clickFlag&&_t.mouseInitPos.x<_maxX&&_t.mouseInitPos.x>_x&&_t.mouseInitPos.y<_maxY&&_t.mouseInitPos.y>_y&&($(this).attr("click-flag",!0),_t.isRobot=!0),_t.lastTime>0){var nextTime=_t.getNextTouchTime();_t.currentTime<nextTime&&(_t.isRobot=!0)}_t.lastTime=_t.currentTime,_t.isRobot?_t.showCaptcha():_t.cartProcess()})})},cartProcess:function(){var _t=this;_t.createKey(),_t.getAjaxToken($.proxy(_t.addShopCart,_t))},showCaptcha:function(){$("#img_captcha").attr("src",XIAOMI.GLOBAL_CONFIG.cartSite+"/misc/showCode"),$("#codeTmpl").modal({backdrop:"static",show:!0})},vCodeTip:function(){function postCheckCode(checkCode,token){$.ajax({url:XIAOMI.GLOBAL_CONFIG.cartSite+"/misc/checkCode?checkCode="+checkCode+"&token="+token,type:"GET",dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){data&&data.code&&1===data.code?($("#codeTmpl").modal("hide"),_t.cartProcess()):$("#authcodeTip").html(data.msg)},error:function(){alert("验证码验证失败，请刷新页面重试sss")}})}var _t=this;$("body").append(codeTmpl),$("#changeCode").click(function(){document.getElementById("verifyCode").value="",document.getElementById("img_captcha").src=XIAOMI.GLOBAL_CONFIG.cartSite+"/misc/showCode?_r="+Math.random(),$("#authcodeTip").html("")}),$("#verifyCode").blur(function(){var authcode=$("#verifyCode");0===authcode.val().length?$("#authcodeTip").html("请您输入正确的验证码"):$("#authcodeTip").html("")}),$("#checkCodeBtn").click(function(){var authcode=$("#verifyCode"),checkCode=$("#verifyCode").val();return authcode.val().length<2||authcode.val().length>15?void $("#authcodeTip").html("请您输入正确的验证码"):($.ajax({url:"http://captcha.hd.mi.com/captcha/auth?answer="+checkCode+"&service=cart.mi.com",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(d){d.data&&d.data.result&&d.data.result===!0&&d.data.token?postCheckCode(checkCode,d.data.token):$("#authcodeTip").html("验证码错误")},error:function(){alert("验证失败，请重试")}}),!1)})},addShopCart:function(){var _t=this,_ranNum=parseInt(1e4*Math.random()),_R=_ranNum+1,_CK=CryptoJS.MD5(_R+""+_t.keyNum.S).toString(),key=CryptoJS.enc.Latin1.parse(_CK),iv=CryptoJS.enc.Latin1.parse("1111111111111111"),encrypted=encodeURIComponent(CryptoJS.AES.encrypt(_t.goodsId,key,{iv:iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding})),url=_t.addCartUrl+"?c="+encrypted+"&r="+_R+"&token="+_t.keyNum.token,errorCallback=function(){alert("网路繁忙，请重试")},successCallback=function(data){1===data.code?_t.endCallback&&_t.endCallback():alert(data.msg)};Util.jsonp(url,successCallback,errorCallback)},getAjaxToken:function(callback){var _t=this,skey=encodeURIComponent(Util.base64().encode(_t.keyNum.P)+","+Util.base64().encode(_t.keyNum.G)+","+Util.base64().encode(_t.keyNum.MA)),url=_t.getTokenUrl+"?skey="+skey,getTimes=0,errorCallback=function(){getTimes++,3>getTimes?getToken():alert("网路繁忙，请重试")},successCallback=function(data){if(1===data.code){var code64=Util.base64().decode(data.data);_t.keyNum.token=code64.split(",")[0],_t.keyNum.MB=code64.split(",")[1],_t.keyNum.S=Util.powMod(_t.keyNum.MB,_t.keyNum.A,_t.keyNum.P),callback&&callback()}else alert(data.msg)},getToken=function(){Util.jsonp(url,successCallback,errorCallback)};getToken()},createKey:function(){var _t=this,primeArr=Util.getPrimeNumber(1e3),_PIndex=parseInt(Math.random()*primeArr.length),_GIndex=parseInt(Math.random()*primeArr.length),_P=primeArr[_PIndex],_G=primeArr[_GIndex],_AIndex=parseInt(Math.random()*(_P-1)),_A=_AIndex+1,_MA=Util.powMod(_G,_A,_P);_t.keyNum={P:_P,G:_G,MA:_MA,A:_A}}};XIAOMI.app.killRobot=MainProces}),XIAOMI.namespace("app.miniCart"),XIAOMI.app.miniCart={elmCartBtn:$("#J_miniCart"),elmCartList:$("#J_miniCartList"),loadingStr:'<p class="loading">数据加载中，请稍后...</p>',speed:500,init:function(){var _this=this,timeOut=null;return"undefined"!=typeof miniCartDisable&&miniCartDisable?!1:"undefined"!=typeof XIAOMI.GLOBAL_CONFIG.closeMiniCart&&"1"===XIAOMI.GLOBAL_CONFIG.closeMiniCart?!1:(_this.elmCartBtn.on({mouseenter:function(){clearTimeout(timeOut),$(this).hasClass("mini-cart-on")||($(this).addClass("mini-cart-on"),_this.show(),_this.getData())},mouseleave:function(){timeOut=setTimeout(function(){_this.close()},_this.speed)}}),_this.elmCartList.on({mouseenter:function(){clearTimeout(timeOut)},mouseleave:function(){timeOut=setTimeout(function(){_this.close()},_this.speed)}}),void _this.elmCartList.on("click",".delItem",function(e){var gId=$(this).attr("gid"),isBigtap=$(this).attr("data-isbigtap");return"true"!==isBigtap||confirm("您正在删除开放购买活动商品\n\n删除后您失去本次开放购买资格，无法下单购买此商品。\n确认删除此商品吗？")?(e.preventDefault(),void _this.delGoods(gId)):!1}))},show:function(){var _this=this;_this.elmCartList.show()},close:function(){var _this=this;_this.elmCartBtn.removeClass("mini-cart-on"),_this.elmCartList.html(this.loadingStr).hide()},delGoods:function(gId){var _this=this;$.ajax({type:"POST",url:XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/delete/"+gId,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(data){1===data.code?(_this.getData(),XIAOMI.app.updateMiniCart()):alert(data.msg)}})},getData:function(){var _this=this;$.ajax({type:"POST",url:XIAOMI.GLOBAL_CONFIG.cartSite+"/cart/miniNew",dataType:"jsonp",jsonp:"jsonpcallback",cache:!1,success:function(data){_this.formatData(data),XIAOMI.app.updateMiniCart()}})},formatData:function(data){var _this=this;if(0===data.errorno&&data.totalItem>0){var lens=data.items.length,goodsUrl=null,listHtml="<ul>",staticUrl=XIAOMI.GLOBAL_CONFIG.staticSite?XIAOMI.GLOBAL_CONFIG.staticSite:"http://static.mi.com",countHtml='<div class="count clearfix"><span class="total">共计 <em>'+data.total+"</em> 件商品<strong>合计：<em>"+data.totalPrice+'元</em></strong></span><a href="'+staticUrl+'/cart/"  class="btn btn-primary">去购物车结算</a></div>';if(data.totalItem>5){var listHeight=335;listHtml='<ul style="height:'+listHeight+'px;overflow-x:hidden;overflow-y:scroll">'}for(var i=0;lens>i;i+=1){var isCos="",cosMask="",price=data.items[i].salePrice+"元 x "+data.items[i].num;data.items[i].is_cos===!0&&(isCos="is-cos",cosMask='<div class="cos-mask"></div>',price="暂时缺货"),0===data.items[i].noLink?(goodsUrl=XIAOMI.GLOBAL_CONFIG.itemSite+"/"+data.items[i].product_id+".html",listHtml+='<li class="clearfix '+isCos+'"><a href="'+goodsUrl+'" class="pic"><img alt="" src="'+data.items[i].image_url+'?width=60&height=60"></a><a href="'+goodsUrl+'" class="name">'+data.items[i].product_name+'</a><span class="price">'+price+'</span><a class="btn-del delItem" href="javascript: void(0);" gid="'+data.items[i].itemId+'" data-isBigtap="'+data.items[i].is_bigtap+'"><i class="iconfont">&#xe607;</i></a>'+cosMask+"</li>"):listHtml+='<li class="clearfix '+isCos+'"><span class="pic"><img alt="" src="'+data.items[i].image_url+'"></span><span   class="name">'+data.items[i].product_name+'</span><span class="price">'+price+'</span><a class="btn-del delItem" href="javascript: void(0);" gid="'+data.items[i].itemId+'" data-isBigtap="'+data.items[i].is_bigtap+'"><i class="iconfont">&#xe607;</i></a>'+cosMask+"</li>"}listHtml+="</ul>",_this.elmCartList.html(listHtml+countHtml)}else 0===data.errorno&&_this.elmCartList.html('<p class="loading">购物车中还没有商品，赶紧选购吧！</p>')}},XIAOMI.namespace("app.miniLogin"),XIAOMI.app.miniLogin=function(){this.orderSite=XIAOMI.GLOBAL_CONFIG.orderSite||"http://order.mi.com",this.quickLoginUrl=XIAOMI.GLOBAL_CONFIG.quickLoginUrl},XIAOMI.app.miniLogin.prototype={constructor:XIAOMI.app.miniLogin,_proxyiframe:function(){var iframesrc=this.orderSite+"/user/proxy/stop/1",iframebody="<iframe src='"+iframesrc+"' width='0' height='0' name='proxy' id='proxy' frameborder='0' scrolling='no'></iframe>";$(document.body).append(iframebody),$("iframe[name='proxy']").load(function(){$("iframe[name='proxy']").remove()})},_toLogin:function(rel){function appendTobody(url){var iframeURL=url?url:_this.quickLoginUrl,content="<iframe src='"+iframeURL+"' width='100%' height='100%' name='miniLoginFrame' id='miniLoginFrame' frameborder='0' scrolling='no'></iframe>",boxWidth=$("#loginBox").attr("data-width"),boxHeight=$("#loginBox").attr("data-Height");$("#loginBox-con").css({height:boxHeight}).html(content),$("#loginBox").css({width:boxWidth,"margin-left":-boxWidth/2}).modal({backdrop:!0,keyboard:!0,show:!0})}function goLocation(){clearInterval(timer),rel?window.location.href=rel:window.location.reload(!0)}function checkHash(){-1!==window.location.href.indexOf("order")?XIAOMI.app.cookie("xm_order_btauth")&&goLocation():XIAOMI.app.cookie("userId")&&goLocation()}var _this=this,shref=encodeURIComponent(window.location.href);$.ajax({url:_this.orderSite+"/site/loginurl?followup="+shref,dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){appendTobody(data.url)},Complete:function(){},error:function(){appendTobody()}});var timer=window.setInterval(checkHash,1e3)},init:function(){var _this=this;-1!==window.location.pathname.indexOf("cart")&&XIAOMI.app.cookie("userId")&&!XIAOMI.app.cookie("xm_order_btauth")&&_this._proxyiframe(),$("[data-needLogin='true']").on("click",function(e){var redirectUrl=encodeURIComponent(window.location.href);return window.location.href=_this.orderSite+"/site/login?ac=1&redirectUrl="+redirectUrl,!1})},_isLogined:function(rel,e){XIAOMI.app.cookie("xm_order_btauth")||(XIAOMI.app.cookie("userId")?this._proxyiframe():(e&&XIAOMI.lang.preventDefault(e),this._toLogin(rel)))},autoExec:function(rel){this._isLogined(rel)}},XIAOMI.namespace("app.navMenus, app.navigation"),XIAOMI.app.navMenus=function(){function toggleMenu(elm,curIndex,show,opt){var options,$menu,$elm=$(elm);return options=$.extend({},defaults,opt),$menu=$elm.children(options.menuSelector),"toggle"===options.effect?show?$menu.removeClass("current").children(options.submenuSelector).hide().end().eq(curIndex).addClass("current").children(options.submenuSelector).show():$menu.removeClass("current").children(options.submenuSelector).hide():"slide"===options.effect?show?($menu.removeClass("current").children(options.submenuSelector).stop(!0,!0).delay(options.speed).slideUp(options.speed),$menu.eq(curIndex).addClass("current").children(options.submenuSelector).stop(!0,!0).slideDown(options.speed)):$menu.removeClass("current").children(options.submenuSelector).stop(!0,!0).slideUp(options.speed):"fade"===options.effect&&(show?($menu.removeClass("current").children(options.submenuSelector).stop(!0,!0).fadeOut(options.speed),$menu.eq(curIndex).children(options.submenuSelector).stop(!0,!0).fadeIn(options.speed)):$menu.removeClass("current").children(options.submenuSelector).stop(!0,!0).fadeOut(options.speed)),$menu.eq(curIndex).children(options.submenuSelector)}function init(elm,opt){function bindToggleEvent(curIndex,show){options.delay>0&&"click"!==options.triggerEvent?show?(timeoutToggle&&window.clearTimeout(timeoutToggle),timeoutToggle=window.setTimeout(function(){toggleMenu($elm,curIndex,!0,options)},options.delay)):(window.clearTimeout(timeoutToggle),timeoutToggle=window.setTimeout(function(){toggleMenu($elm,curIndex,!1,options)},options.delay)):show?toggleMenu($elm,curIndex,!0,options):toggleMenu($elm,curIndex,!1,options),"function"==typeof options.callback&&options.callback($elm,curIndex,options)}var options,$menu,timeoutToggle,$elm=$(elm);return 0===$elm.length?$elm:$elm.length>1?($elm.each(function(){init($(this),opt)}),this):(options=$.extend({},defaults,opt),$menu=$elm.children(options.menuSelector),"hover"===options.triggerEvent?$menu.on({mouseenter:function(){bindToggleEvent($menu.index($(this)),!0)},mouseleave:function(){bindToggleEvent($menu.index($(this)),!1)}}):"click"===options.triggerEvent&&$menu.on("click",function(e){e.preventDefault(),$(this).hasClass("toggled")?($(this).removeClass("toggled"),bindToggleEvent($menu.index($(this)),!1)):($menu.removeClass("toggled"),$(this).addClass("toggled"),bindToggleEvent($menu.index($(this)),!0))}),void(window.ActiveXObject&&!window.XMLHttpRequest&&$menu.find(options.submenuSelector).find("a").on("click",function(e){window.location.href=$(this).attr("href")})))}var defaults;return defaults={menuSelector:".menu",submenuSelector:".children",triggerEvent:"hover",effect:"toggle",delay:200,speed:200,callback:function(){}},{toggleMenu:toggleMenu,init:init}}(),XIAOMI.app.navCategory=function(){function lazyLoadImg(elm){var $elm=$(elm);$elm.each(function(){$(this).hasClass("img-loaded")||"string"!=typeof $(this).attr("data-src")||$(this).addClass("img-loaded").attr({src:$(this).attr("data-src"),srcset:$(this).attr("data-srcset")})})}function addSrcset(elm){var $imgs=elm.find("img");$imgs.each(function(){if(/40x40/.test($(this).attr("data-src"))){var url2x=$(this).attr("data-src").replace("40x40","80x80");$(this).attr("data-srcset",url2x+" 2x")}})}function toggleCategoryList(option){"show"===option?($categoryContainer.addClass("nav-category-toggled"),$categoryTriggerBtn.find(".iconfont").html("&#xe606;"),$categoryList.show()):"static"===option?($categoryContainer.addClass("nav-category-toggled"),$categoryList.show()):($categoryContainer.removeClass("nav-category-toggled"),$categoryTriggerBtn.find(".iconfont").html("&#xe608;"),$categoryList.hide().find(".nav-category-list").children("li").removeClass("current"))}function bindChildrenList(){var timeoutChildrenList;$categoryList.find(".nav-category-list").children("li").on({mouseenter:function(){var $this=$(this);window.clearTimeout(timeoutChildrenList),$this.hasClass("current")||(timeoutChildrenList=window.setTimeout(function(){$this.addClass("current").siblings("li").removeClass("current");var $children=$this.find(".nav-category-children");if($children.length){if($children.offset().top-$categoryContainer.offset().top-$categoryContainer.height()+$children.height()>$categoryList.height()){var bottomFix=$children.offset().top-$categoryContainer.offset().top-$categoryContainer.height()+73-$categoryList.height();$children.css({top:"auto",bottom:bottomFix})}addSrcset($children),lazyLoadImg($children.find("img"))}},100))},mouseleave:function(){var $this=$(this);window.clearTimeout(timeoutChildrenList),timeoutChildrenList=window.setTimeout(function(){$this.removeClass("current")},100)}})}function init(){var isCategoryStatic="undefined"!=typeof isCategoryToggled?isCategoryToggled:!1,MI_SITES={orderSite:"http://order.mi.com",wwwSite:"http://www.mi.com",cartSite:"http://cart.mi.com",itemSite:"http://item.mi.com",listSite:"http://list.mi.com",searchSite:"http://search.mi.com",mySite:"http://my.mi.com"},templateHtml='{{? it.children}}<li class="nav-category-item nav-category-item-first"><div class="nav-category-content"><a class="title" href="'+MI_SITES.wwwSite+'/buyphone/">购买手机</a><div class="links"><a href="'+MI_SITES.itemSite+'/buyphone/minote">小米Note</a><a href="'+MI_SITES.itemSite+'/buyphone/mi4">小米4</a><a href="'+MI_SITES.itemSite+'/buyphone/hongmi2">红米</a><a href="'+MI_SITES.itemSite+'/buyphone/note">红米Note</a></div><div class="nav-category-children"><ul class="children-list"><li><a href="'+MI_SITES.itemSite+'/buyphone/minote"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/minote.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/minote_2x.jpg 2x" alt="购买小米Note"><span class="text">小米Note</span></a></li><li><a href="'+MI_SITES.itemSite+'/buyphone/mi4"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mi4.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mi4_2x.jpg 2x" alt="购买小米手机4"><span class="text">小米手机4</span></a></li><li><a href="'+MI_SITES.itemSite+'/buyphone/hongmi2"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/redmi2.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/redmi2_2x.jpg 2x" alt="购买红米手机2"><span class="text">红米手机2</span></a></li><li><a href="'+MI_SITES.itemSite+'/buyphone/note"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/redminote.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/redminote_2x.jpg 2x" alt="购买红米Note"><span class="text">红米Note</span></a></li><li><a href="http://heyue.mi.com/"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/heyue.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/heyue_2x.jpg 2x" alt="合约机"><span class="text">合约机</span></a></li><li><a href="'+MI_SITES.wwwSite+'/c/peijian/"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/typeacc.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/typeacc_2x.jpg 2x" alt="根据机型选配件"><span class="text">根据机型选配件</span></a></li></ul><div class="children-special-section"><h4>明星配件</h4><ul><li><a href="'+MI_SITES.wwwSite+'/shouhuan">小米手环 79元</a></li><li><a href="'+MI_SITES.listSite+'/102">小米活塞耳机 99元</a></li></ul></div></div></div></li><li class="nav-category-item"><div class="nav-category-content"><a class="title" href="'+MI_SITES.wwwSite+'/buytvpad/">购买电视与平板</a><div class="links"><a href="'+MI_SITES.itemSite+'/static/buymitv">小米电视</a><a href="'+MI_SITES.itemSite+'/static/buyhezi">小米盒子</a><a href="'+MI_SITES.itemSite+'/static/buymipad">小米平板</a></div><div class="nav-category-children"><ul class="children-list"><li><a href="'+MI_SITES.itemSite+'/static/buymitv"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mitv.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mitv_2x.jpg 2x" alt="购买小米电视2"><span class="text">小米电视2</span></a></li><li><a href="'+MI_SITES.itemSite+'/static/buyhezi"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mibox.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mibox_2x.jpg 2x" alt="购买小米盒子"><span class="text">小米盒子</span></a></li><li><a href="'+MI_SITES.itemSite+'/static/buymipad"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mipad.jpg" data-srcset="http://c1.mifile.cn/f/i/2014/cn/nav/icons/mipad_2x.jpg 2x" alt="购买小米平板"><span class="text">小米平板</span></a></li></ul><div class="children-special-section"><h4>明星配件</h4><ul><li><a href="'+MI_SITES.listSite+'/0-256">小米电视配件</a></li><li><a href="'+MI_SITES.listSite+'/0-8">小米盒子配件</a></li><li><a href="'+MI_SITES.listSite+'/0-4567890">小米平板配件</a></li></ul></div></div></li>{{~it.children :value:index}} {{? index < 6}}<li class="nav-category-item"><div class="nav-category-content"><a class="title" href="'+MI_SITES.listSite+'/{{= value.cat_id }}">{{= value.name_alias || value.cat_name }}</a><div class="links">{{~value.highlight_children :highlight_value:highlight_index}}<a href="'+MI_SITES.listSite+'/{{= highlight_value.cat_id }}">{{= highlight_value.cat_name }}</a>{{~}}</div>{{? value.children}}<div class="nav-category-children{{? value.children.length > 8}} nav-category-children-col-2{{?}}"><ul class="children-list">{{~value.children :children_value:children_index}}<li><a href="'+MI_SITES.listSite+'/{{= children_value.cat_id }}"><img src="http://c1.mifile.cn/f/i/2014/cn/placeholder-80.png" width="40" height="40" data-src="{{= children_value.cat_icon }}" alt="{{= children_value.cat_name }}"><span class="text">{{= children_value.cat_name }}</span></a></li>{{~}}</ul>{{? value.topsales.length > 0 && value.children.length <= 8 }}<div class="children-special-section"><h4>热门商品</h4><ul>{{~value.topsales :topsales_value:topsales_index}}<li><a href="'+MI_SITES.itemSite+'/{{= topsales_value.id}}.html">{{= topsales_value.name_alias || topsales_value.name }} {{= topsales_value.price_max }}元</a></li>{{~}}</ul></div>{{?}}</div>{{?}}</div></li>{{?}}{{~}}{{?}}',templateCategory=doT.template(templateHtml),oDate=new Date,categoryVersion=[oDate.getFullYear(),oDate.getMonth()+1,oDate.getDate(),oDate.getHours(),parseInt(oDate.getMinutes()/5)],categorySource=XIAOMI.GLOBAL_CONFIG.wwwSite+"/c/service/js/categoryTree.js?ver="+categoryVersion.join("");
$.ajax({url:categorySource,dataType:"script",cache:!0,success:function(){if("undefined"==typeof categoryTree)return!1;if($("#J_categoryContainer").find(".nav-category-list").html(templateCategory(categoryTree)),XIAOMI.app.analytics([$(".nav-category-content > a"),$(".nav-category-content .links").find("a"),$(".nav-category-content .children-list").find("a"),$(".nav-category-content .children-special-section").find("a")],{page:"分类导航",position:["A","B","C","D"],JQelement:!0,url:!1,isStat:!0,pidPosition:["头部分类导航第一级","头部分类导航第二级","头部分类导航第三级","头部分类导航热门商品"]}),isCategoryStatic)toggleCategoryList("static");else{$categoryTriggerBtn.append('<i class="iconfont">&#xe608;</i>');var timeoutCategory;$categoryContainer.on({mouseenter:function(){window.clearTimeout(timeoutCategory),$(this).hasClass("nav-category-toggled")||(timeoutCategory=window.setTimeout(function(){toggleCategoryList("show")},200))},mouseleave:function(){window.clearTimeout(timeoutCategory),$(this).hasClass("nav-category-toggled")&&(timeoutCategory=window.setTimeout(function(){toggleCategoryList("hide")},200))}})}bindChildrenList()}})}var $categoryContainer=$("#J_categoryContainer"),$categoryTriggerBtn=$categoryContainer.children(".btn-category-list"),$categoryList=$categoryContainer.children(".nav-category-section");return{init:init}}(),XIAOMI.namespace("app.placeholder"),XIAOMI.app.placeholder=function(el,opt){var defaults,options,elm=$(el),isPlaceholderSupported="placeholder"in document.createElement("input");return 0===elm.length?elm:elm.length>1?(elm.each(function(){XIAOMI.app.placeholder($(this),opt)}),this):(defaults={blurClass:"xm-ph-blur"},options=$.extend({},defaults,opt),void(!isPlaceholderSupported&&elm.attr("placeholder")&&(elm.is("textarea")?""===elm.html()&&elm.addClass(options.blurClass).html(elm.attr("placeholder")):""===elm.val()&&elm.addClass(options.blurClass).val(elm.attr("placeholder")),elm.on({focus:function(){$(this).is("textarea")?$(this).html()===elm.attr("placeholder")&&$(this).removeClass(options.blurClass).html(""):$(this).val()===elm.attr("placeholder")&&$(this).removeClass(options.blurClass).val("")},blur:function(){$(this).is("textarea")?""===$(this).html()&&$(this).addClass(options.blurClass).html(elm.attr("placeholder")):""===$(this).val()&&$(this).addClass(options.blurClass).val(elm.attr("placeholder"))}}))))},XIAOMI.namespace("app.carousel"),XIAOMI.app.carousel=function(){function init(elm,opt){function slideList(targetPage){var offsetX="-"+targetPage*itemWidth*itemPerSlide+"px";$list.animate({"margin-left":offsetX},options.speed),targetPage>0&&countPage-1>targetPage?($btnPrev.removeClass("page-btn-prev-disabled"),$btnNext.removeClass("page-btn-next-disabled")):0===targetPage?($btnPrev.addClass("page-btn-prev-disabled"),$btnNext.removeClass("page-btn-next-disabled")):targetPage===countPage-1&&($btnPrev.removeClass("page-btn-prev-disabled"),$btnNext.addClass("page-btn-next-disabled"))}function autoPlay(){return 0>=countPage?!1:(elm.timeoutAuto&&window.clearInterval(elm.timeoutAuto),void(elm.timeoutAuto=setInterval(function(){curIndex+=1,curIndex>countPage-1&&(curIndex=0),slideList(curIndex)},options.delay)))}var options,$listWrap,$list,$btnPrev,$btnNext,itemLength,itemWidth,itemHeight,itemPerSlide,countPage,$elm=$(elm),curIndex=0;return 0===$elm.length?$elm:$elm.length>1?($elm.each(function(){init($(this),opt)}),this):(options=$.extend({},defaults,opt),$listWrap=$elm.find(options.listWrapSelector),$list=$listWrap.find(options.listSelector),$btnPrev=$elm.find(options.prevBtnSelector),$btnNext=$elm.find(options.nextBtnSelector),itemWidth=options.itemWidth||$list.children(options.itemSelector).outerWidth(),itemHeight=options.itemHeight||$list.children(options.itemSelector).outerHeight()-1,itemLength=$list.children(options.itemSelector).length,itemPerSlide=4!==itemLength?Math.ceil($listWrap.width()/itemWidth):4,countPage=Math.ceil(itemLength/itemPerSlide),1===countPage&&($btnPrev.hide(),$btnNext.hide()),$listWrap.css({height:itemHeight}),$list.css({width:itemWidth*itemLength,"margin-left":0}),$btnPrev.addClass("page-btn-prev-disabled"),1>=countPage&&$btnNext.addClass("page-btn-next-disabled"),window.clearInterval(elm.timeoutAuto),slideList(0),options.autoPlay&&(autoPlay(),$elm.on({mouseenter:function(){elm.timeoutAuto&&window.clearInterval(elm.timeoutAuto)},mouseleave:function(){autoPlay()}})),$btnPrev.off("click.carousel").on("click.carousel",function(e){e.preventDefault(),$(this).hasClass("page-btn-prev-disabled")||(curIndex-=1,0>=curIndex&&(curIndex=0,$(this).addClass("page-btn-prev-disabled")),$btnNext.removeClass("page-btn-next-disabled"),slideList(curIndex))}),void $btnNext.off("click.carousel").on("click.carousel",function(e){e.preventDefault(),$(this).hasClass("page-btn-next-disabled")||(curIndex+=1,curIndex>countPage-1&&(curIndex=countPage-1,$(this).addClass("page-btn-next-disabled")),$btnPrev.removeClass("page-btn-prev-disabled"),slideList(curIndex))}))}var defaults;return defaults={listWrapSelector:".J_carouselWrap",listSelector:".J_carouselList",itemSelector:"li",prevBtnSelector:".J_carouselPrev",nextBtnSelector:".J_carouselNext",itemWidth:null,itemHeight:null,autoPlay:!0,speed:500,delay:5e3},{init:init}}(),XIAOMI.namespace("app.search"),XIAOMI.app.search={speed:200,inputObj:null,keyword:null,init:function(){var timeoutFocus,_this=this,timeOut=null,$searchForm=$("#J_searchForm"),searchConfig={};_this.inputObj=$searchForm.find(".search-text"),_this.inputObj.data("search-config")&&(searchConfig=$.parseJSON(_this.inputObj.data("search-config").replace(/'/g,'"'))),$searchForm.append($('<div id="J_keywordList" class="keyword-list hide"><ul class="result-list"></ul></div>')),_this.inputObj.on({focus:function(){window.clearTimeout(timeoutFocus),$("#J_keywordList").css("opacity",1),$searchForm.addClass("search-form-focus"),!$(this).val()&&searchConfig.defaultWords&&_this.formatData(searchConfig.defaultWords)},blur:function(){$("#J_keywordList").css("opacity",0),timeoutFocus=window.setTimeout(function(){$searchForm.removeClass("search-form-focus")},200)},keyup:function(e){$.trim($(this).val()).length<=0&&searchConfig.defaultWords&&(_this.keyword=null,_this.formatData(searchConfig.defaultWords)),_this.focusMove(e.which),clearTimeout(timeOut),40!==e.which&&38!==e.which&&(timeOut=setTimeout(function(){_this.keyword=_this.inputObj.val(),_this.getResult(_this.keyword)},_this.speed))}}),$searchForm.on("mouseenter","#J_keywordList li",function(){$(this).addClass("current").siblings().removeClass("current")}),_this.submit()},getResult:function(k){var _this=this;k&&$.ajax({type:"GET",url:"http://search.mi.com/search/expand?keyword="+encodeURIComponent(k),dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"xmsearch",cache:!0,success:function(data){data.length>0?_this.inputObj.val()&&_this.formatData(data):_this.removeList()}})},formatData:function(data){for(var listHtml="",i=0,lens=data.length;lens>i;i+=1){var keywordStr,keywordRst;"object"==typeof data[i]?(keywordStr=data[i].Key.replace(this.keyword,'<span class="keyword">'+this.keyword+"</span> "),keywordRst=data[i].Rst?'<span class="result">约有'+data[i].Rst+"件商品</span>":"",listHtml+='<li data-key="'+data[i].Key+'"><a href="http://search.mi.com/search_'+encodeURIComponent(data[i].Key)+'">'+keywordStr+keywordRst+"</a></li>"):(keywordStr=data[i].replace(this.keyword,'<span class="keyword">'+this.keyword+"</span> "),keywordRst="",listHtml+='<li data-key="'+data[i]+'"><a href="http://search.mi.com/search_'+encodeURIComponent(data[i])+'">'+keywordStr+keywordRst+"</a></li>")}$("#J_keywordList").removeClass("hide").children(".result-list").html(listHtml)},focusMove:function(keyCode){var _this=this,$keywordList=$("#J_keywordList"),$items=$keywordList.find("li"),i=$keywordList.find(".current").index()||0,lens=$items.length-1;if(38===keyCode){if(i-=1,0>i)return i=0,!1;$items.eq(i).addClass("current").siblings().removeClass("current"),_this.inputObj.val($items.eq(i).attr("data-key"))}else if(40===keyCode){if(i+=1,i>lens)return i=lens,!1;$items.eq(i).addClass("current").siblings().removeClass("current"),_this.inputObj.val($items.eq(i).attr("data-key"))}},removeList:function(){$("#J_keywordList").addClass("hide").children(".result-list").html("")},submit:function(){var _this=this;$("#J_searchForm").on("submit",function(){var val=$.trim(_this.inputObj.val());return""!==val&&(val=val.replace(/[\-_'=+|\\\/]/g," "),window.location.href="http://search.mi.com/search_"+encodeURIComponent(val)),!1})}},XIAOMI.namespace("app.selector"),XIAOMI.app.selector={defaultOption:{reorder:!1,buildLI:function(index,obj,elmUL){var objLI=$('<li data-index="'+index+'"><span>'+obj.text+"</span></li>");obj.selected&&objLI.addClass("selected"),elmUL.append(objLI)},afterChange:function(val){}},init:function(elm,opt){function reorderList(elm){elm.insertBefore(elm.closest("ul").children("li")[0]),elmText.text(elm.text())}var options,elmSelect,elmWrap,elmText,elmList,elmArrow,_this=this,data=[];return 0===elm.length?elm:elm.length>1?(elm.each(function(){_this.init($(this),opt)}),this):(options=$.extend({},_this.defaultOption,opt),elmSelect=elm,elmWrap=$('<div class="xm-select"></div>').insertAfter(elmSelect),elmText=$('<div class="dropdown-text"></div>'),elmList=$('<ul class="dropdown-menu"></ul>'),elmArrow=$('<span class="arrow-down"></span>'),elmSelect.children("option").each(function(){data.push({text:$(this).text(),value:$(this).attr("value"),selected:$(this).attr("selected")})}),$(data).each(function(index,obj){options.buildLI(index,obj,elmList)}),elmWrap.append(elmText,elmList,elmArrow,elmSelect),elmSelect.hide(),options.reorder===!0&&0!==elmList.children("li").index(elmList.children(".selected"))?reorderList(elmList.children(".selected")):elmText.text(data[0].text),elmList.on("click","li",function(){var val=elmSelect.children("option").eq($(this).attr("data-index")).val();elmSelect.val(val).change(),$(this).addClass("selected").siblings("li").removeClass("selected"),options.reorder===!0?0!==elmList.children("li").index(this)&&(reorderList($(this)),elmList.hide()):(elmText.text($(this).text()),elmList.hide()),options.afterChange(val)}),void elmWrap.on({mouseover:function(){elmWrap.addClass("toggled"),elmList.show()},mouseout:function(){elmWrap.removeClass("toggled"),elmList.hide()}}))}},XIAOMI.namespace("app.setLoginInfo"),XIAOMI.app.setLoginInfo={data:{userId:0,userName:"",goodsNum:0},miid:parseInt(XIAOMI.app.cookie("userId")),miidLink:XIAOMI.app.cookie("xm_link_history"),defautConfig:{},init:function(globalConfig){var _this=this;this.config=$.extend({},globalConfig,this.defautConfig),this.uuidCookie(),this.miid&&0!=this.miid&&this.miidLink?(this.data.userName=this.miid?XIAOMI.app.cookie("XM_"+this.miid+"_UN"):"",this.data.goodsNum=XIAOMI.app.cookie("xm_user_www_num"),this.data.goodsNum=null==this.data.goodsNum?0:this.data.goodsNum,null==this.data.userName||""===this.data.userName?_this.createScript(this.miid):this.updateDom(this.miid)):$.ajax({dataType:"JSONP",url:"http://userid.xiaomi.com/userId",jsonpCallback:"userLogincallback",success:function(data){if(0!=data.userId&&null!=data.userId){var option={path:"/",domain:".mi.com"};XIAOMI.app.cookie("userId",data.userId,option),_this.createScript(data.userId)}}})},createScript:function(uid){this.updateDom(uid);var script=document.createElement("script");script.src="https://account.xiaomi.com/pass/userInfoJsonP?userId="+uid+"&callback=setLoginInfo_getAccountInfo",script.type="text/javascript",script.async=!0,document.getElementsByTagName("head")[0].appendChild(script)},updateDom:function(uid){var displayName=this.data.userName;null!=displayName&&""!==displayName?displayName.length>7&&(displayName=displayName.substr(0,7)+"…"):displayName=uid;var randomStr="undefined"!=typeof XIAOMI.app.cookie("userId")?XIAOMI.app.cookie("userId"):"";randomStr+="_t"+(new Date).getTime();var timeoutUserMenu,staticUrl=XIAOMI.GLOBAL_CONFIG.staticSite?XIAOMI.GLOBAL_CONFIG.staticSite:"http://static.mi.com",html='欢迎您 <b class="user-name">'+displayName+'<span class="arrow"></span></b><span class="sep">|</span><a href="'+staticUrl+'/order/">我的订单</a><span class="sep">|</span><a href="http://account.xiaomi.com/" target="_blank">我的小米账户</a>',$userInfoMenu=$('<div class="user-info-menu"><ul><li><a href="http://my.mi.com/portal" target="_blank">个人中心</a></li><li><a href="'+XIAOMI.GLOBAL_CONFIG.orderSite+'/user/favorite">我的收藏</a></li><li><a href="'+this.config.logoutUrl+'">退出登录</a></li></ul><span class="menu-arrow"></span></div>');$(".J_userInfo").html(html).append($userInfoMenu).on({mouseenter:function(){timeoutUserMenu&&window.clearTimeout(timeoutUserMenu),$userInfoMenu.show()},mouseleave:function(){timeoutUserMenu=window.setTimeout(function(){$userInfoMenu.hide()},200)}},".user-name"),$userInfoMenu.on({mouseenter:function(){timeoutUserMenu&&window.clearTimeout(timeoutUserMenu)},mouseleave:function(){timeoutUserMenu=window.setTimeout(function(){$userInfoMenu.hide()},200)}})},uuidCookie:function(){var myUuidValue=("xmguest-"+uuid.v1()).toUpperCase(),myUuid=XIAOMI.app.cookie("xmuuid");if(!myUuid){var option={path:"/",domain:".mi.com",expires:18250};XIAOMI.app.cookie("xmuuid",myUuidValue,option)}}};var setLoginInfo_getAccountInfo=function(data){var _this=XIAOMI.app.setLoginInfo;if(data.userId){_this.data.userName=data.uniqName?data.uniqName:data.userId;var option={path:"/",domain:".mi.com"};XIAOMI.app.cookie("XM_"+_this.miid+"_UN",_this.data.userName,option),_this.updateDom(data.userId)}};XIAOMI.namespace("setRecommend"),XIAOMI.app.setRecommend=function(options){var option={obj:$("#item-recommend-box"),tmpl:$("#item-recommend-template"),url:XIAOMI.GLOBAL_CONFIG.sideBarApiUrl+"cart/get/id/1134900361,1134900465,1135000458,1140400001/callback/itemRecommend/cid/2",max:5,min:0,box:$("#RECOMMEND-MODAL"),callback:null};$.extend(option,options||{}),$(option.obj).show();var recommendAppear={appearPluginSource:XIAOMI.GLOBAL_CONFIG.wwwSite+"/js/libs/jquery.appear.min.js",getPluginScript:function(){var _this=this,regionID=option.box.attr("id"),regionName=option.box.attr("data-stat-recommend");$.ajax({dataType:"script",url:_this.appearPluginSource,success:function(){option.box.appear(),option.box.one("appear",function(e,$affected){_msq.push(["trackPanelShow",regionID,regionName])})},cache:!0})},init:function(){option.box.length>0&&this.getPluginScript()}};recommendAppear.init(),$.ajax({dataType:"JSONP",url:option.url,jsonpCallback:"itemRecommend",success:function(data){var template=doT.template($(option.tmpl).html()),result=data.result,itemList=[];for(var item in result)item<option.max&&itemList.push(result[item]);return itemList.length<option.min?!1:void(0!==itemList.length&&"error"!==result?($(option.obj).html(template(itemList)),null!==option.callback&&"function"==typeof option.callback&&option.callback()):$(option.obj).hide())}})};;+function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(void 0!==el.style[name])return{end:transEndEventNames[name]};return!1}$.fn.emulateTransitionEnd=function(duration){var called=!1,$el=this;$(this).one($.support.transition.end,function(){called=!0});var callback=function(){called||$($el).trigger($.support.transition.end)};return setTimeout(callback,duration),this},$(function(){$.support.transition=transitionEnd()})}(jQuery);;!function($){"use strict";var Modal=function(element,options){this.options=options,this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(document.body),that.$element.show(),transition&&that.$element[0].offsetWidth,that.$element.addClass("in").attr("aria-hidden",!1),that.enforceFocus(),transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")}))},hide:function(e){e&&e.preventDefault();e=$.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),$(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){that.$element[0]===e.target||that.$element.has(e.target).length||that.$element.focus()})},escape:function(){var that=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&that.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end),that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout),that.hideModal()})},hideModal:function(){var that=this;this.$element.hide(),this.backdrop(function(){that.removeBackdrop(),that.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(callback){var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate,pageHeight=$(document).height(),pageWidth="100%";if(this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body),this.$backdrop.css({width:pageWidth,height:pageHeight}).click("static"==this.options.backdrop?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this)),doAnimate&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback):callback()):callback&&callback()}};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new Modal(this,options)),"string"==typeof option?data[option]():options.show&&data.show()})},$.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault(),$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery);;!function(){"use strict";function encodeHTMLSource(){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):this}}function resolveDefs(c,block,def){return("string"==typeof block?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?(c.defineParams&&value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}}),code in def||(def[code]=value)):new Function("def","def['"+code+"']="+value)(def)),""}).replace(c.use||skip,function(m,code){c.useParams&&(code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");return def.__exp=def.__exp||{},def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2"),s+"def.__exp['"+rw+"']"}}));var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var global,doT={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):(global=function(){return this||(0,eval)("this")}(),global.doT=doT),String.prototype.encodeHTML=encodeHTMLSource();var startend={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},skip=/$^/;doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var needhtmlencode,indv,cse=c.append?startend.append:startend.split,sid=0,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){return needhtmlencode=!0,cse.start+unescape(code)+cse.endencode}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='":code?"';if("+unescape(code)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(m,iterate,vname,iname){return iterate?(sid+=1,indv=iname||"i"+sid,iterate=unescape(iterate),"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),needhtmlencode&&c.selfcontained&&(str="String.prototype.encodeHTML=("+encodeHTMLSource.toString()+"());"+str);try{return new Function(c.varname,str)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),e}},doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}}();